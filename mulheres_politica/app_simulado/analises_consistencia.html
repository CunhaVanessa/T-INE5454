<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio de Consist√™ncia dos Dados - Mulheres na Pol√≠tica</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
            color: #333;
        }
        
        .notebook-container {
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .notebook-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .notebook-header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .notebook-header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .notebook-cell {
            border-bottom: 1px solid #e1e5e9;
            position: relative;
        }
        
        .cell-input {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
        }
        
        .cell-type {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .cell-content h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .cell-content h3 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .cell-content p {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .cell-output {
            padding: 20px;
            background: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            text-align: center;
        }
        
        .stat-card h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }
        
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .chart-bar {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 5px;
        }
        
        .chart-label {
            min-width: 120px;
            font-weight: 500;
        }
        
        .chart-bar-fill {
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            margin: 0 10px;
        }
        
        .chart-value {
            font-weight: bold;
            color: #333;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
        }
        
        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        .quality-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin: 2px;
        }
        
        .quality-high { background: #d4edda; color: #155724; }
        .quality-medium { background: #fff3cd; color: #856404; }
        .quality-low { background: #f8d7da; color: #721c24; }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            z-index: 1000;
        }
        
        .back-button:hover {
            background: #764ba2;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <a href="app_demo.html" class="back-button">‚Üê Voltar ao Dashboard</a>
    
    <div class="notebook-container">
        <div class="notebook-header">
            <h1>üìä Relat√≥rio de Consist√™ncia dos Dados</h1>
            <p>An√°lise Completa da Qualidade e Estrutura dos Dados</p>
            <p><em>Projeto: Mulheres na Pol√≠tica Brasileira</em></p>
        </div>

        <!-- Cell 1: Introdu√ß√£o -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Markdown</div>
                <div class="cell-content">
                    <h2>1. Introdu√ß√£o e Objetivos</h2>
                    <p>Este relat√≥rio apresenta uma an√°lise detalhada da consist√™ncia, qualidade e estrutura dos dados coletados sobre mulheres na pol√≠tica brasileira.</p>
                    <p><strong>Dataset analisado:</strong> 10.938 registros de deputadas federais, senadoras e vereadoras</p>
                    <p><strong>Per√≠odo de coleta:</strong> Dezembro de 2024</p>
                    <p><strong>Fontes:</strong> C√¢mara dos Deputados, Senado Federal e TSE</p>
                </div>
            </div>
        </div>

        <!-- Cell 2: Carregamento dos Dados -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Code</div>
                <div class="cell-content">
                    <h3>Carregamento e Configura√ß√£o Inicial</h3>
                    <div class="code-block">
# Carregamento dos dados consolidados
import json
import pandas as pd
from collections import Counter
import numpy as np

# Carregar dados do arquivo JSON consolidado
with open('../data/mulheres_politica_consolidado.json', 'r', encoding='utf-8') as f:
    dados = json.load(f)

parlamentares = dados['parlamentares']
print(f"Total de registros carregados: {len(parlamentares)}")
                    </div>
                </div>
            </div>
            <div class="cell-output">
                <div class="loading" id="loading-data">Carregando dados...</div>
                <div id="basic-stats" style="display: none;"></div>
            </div>
        </div>

        <!-- Cell 3: Estrutura dos Dados -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Code</div>
                <div class="cell-content">
                    <h3>An√°lise da Estrutura dos Dados</h3>
                    <div class="code-block">
# An√°lise dos atributos dispon√≠veis
sample_record = parlamentares[0] if parlamentares else {}
attributes = list(sample_record.keys())

print("Atributos encontrados:")
for i, attr in enumerate(attributes, 1):
    print(f"{i:2}. {attr}")
                    </div>
                </div>
            </div>
            <div class="cell-output">
                <div id="attributes-analysis"></div>
            </div>
        </div>

        <!-- Cell 4: Tipos de Dados -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Code</div>
                <div class="cell-content">
                    <h3>Detec√ß√£o Autom√°tica de Tipos de Dados</h3>
                    <div class="code-block">
# An√°lise dos tipos de dados por campo
def detect_data_type(values):
    """Detecta o tipo de dado predominante em uma lista de valores"""
    non_empty = [v for v in values if v and str(v).strip() and v != 'N/A']
    
    if not non_empty:
        return 'Vazio'
    
    # Teste para data (formato DD/MM/YYYY)
    date_pattern = r'\d{2}/\d{2}/\d{4}'
    if all(re.match(date_pattern, str(v)) for v in non_empty[:100]):
        return 'Data'
    
    # Teste para n√∫mero
    try:
        [float(str(v).replace(',', '.')) for v in non_empty[:10]]
        return 'N√∫mero'
    except:
        pass
    
    # Teste para email
    if any('@' in str(v) for v in non_empty[:10]):
        return 'Email'
    
    # Padr√£o: texto
    return 'Texto'

# Aplicar detec√ß√£o para cada atributo
data_types = {}
for attr in attributes:
    values = [record.get(attr, '') for record in parlamentares]
    data_types[attr] = detect_data_type(values)
                    </div>
                </div>
            </div>
            <div class="cell-output">
                <div id="data-types-analysis"></div>
            </div>
        </div>

        <!-- Cell 5: An√°lise de Completude -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Code</div>
                <div class="cell-content">
                    <h3>An√°lise de Completude dos Dados</h3>
                    <div class="code-block">
# Calcular percentual de preenchimento por campo
total_records = len(parlamentares)
completeness = {}

for attr in attributes:
    non_empty_count = sum(1 for record in parlamentares 
                         if record.get(attr) and str(record.get(attr)).strip() 
                         and record.get(attr) != 'N/A')
    completeness[attr] = (non_empty_count / total_records) * 100

# Ordenar por completude
sorted_completeness = sorted(completeness.items(), key=lambda x: x[1], reverse=True)
                    </div>
                </div>
            </div>
            <div class="cell-output">
                <div id="completeness-analysis"></div>
            </div>
        </div>

        <!-- Cell 6: An√°lise de Tamanho -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Code</div>
                <div class="cell-content">
                    <h3>An√°lise de Tamanho das Entradas</h3>
                    <div class="code-block">
# Calcular estat√≠sticas de tamanho para campos de texto
text_fields_stats = {}

for attr in attributes:
    if data_types[attr] in ['Texto', 'Email']:
        lengths = []
        for record in parlamentares:
            value = record.get(attr, '')
            if value and str(value).strip() and value != 'N/A':
                lengths.append(len(str(value)))
        
        if lengths:
            text_fields_stats[attr] = {
                'min': min(lengths),
                'max': max(lengths),
                'avg': sum(lengths) / len(lengths),
                'samples': len(lengths)
            }
                    </div>
                </div>
            </div>
            <div class="cell-output">
                <div id="text-size-analysis"></div>
            </div>
        </div>

        <!-- Cell 7: An√°lise de Qualidade -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Code</div>
                <div class="cell-content">
                    <h3>An√°lise de Qualidade e Consist√™ncia</h3>
                    <div class="code-block">
# Detectar poss√≠veis inconsist√™ncias e problemas de qualidade
quality_issues = {
    'empty_names': 0,
    'missing_party': 0,
    'missing_state': 0,
    'invalid_dates': 0,
    'duplicate_names': 0
}

names_seen = set()
for record in parlamentares:
    # Nomes vazios
    if not record.get('nome') or not str(record.get('nome')).strip():
        quality_issues['empty_names'] += 1
    
    # Partidos vazios
    if not record.get('partido') or record.get('partido') == 'N/A':
        quality_issues['missing_party'] += 1
    
    # Estados vazios
    if not record.get('uf') or len(str(record.get('uf', ''))) != 2:
        quality_issues['missing_state'] += 1
    
    # Nomes duplicados
    nome = str(record.get('nome', '')).strip().lower()
    if nome in names_seen:
        quality_issues['duplicate_names'] += 1
    else:
        names_seen.add(nome)
                    </div>
                </div>
            </div>
            <div class="cell-output">
                <div id="quality-analysis"></div>
            </div>
        </div>

        <!-- Cell 8: Resumo Executivo -->
        <div class="notebook-cell">
            <div class="cell-input">
                <div class="cell-type">Markdown</div>
                <div class="cell-content">
                    <h2>8. Resumo Executivo e Recomenda√ß√µes</h2>
                    <div id="executive-summary"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let parlamentares = [];
        let attributes = [];
        let dataTypes = {};
        let completeness = {};

        // Fun√ß√£o principal para carregar e analisar os dados
        async function loadAndAnalyzeData() {
            try {
                const response = await fetch('../data/mulheres_politica_consolidado.json');
                const data = await response.json();
                parlamentares = data.parlamentares || [];
                
                document.getElementById('loading-data').style.display = 'none';
                document.getElementById('basic-stats').style.display = 'block';
                
                // Executar todas as an√°lises
                analyzeBasicStats();
                analyzeAttributes();
                analyzeDataTypes();
                analyzeCompleteness();
                analyzeTextSizes();
                analyzeQuality();
                generateExecutiveSummary();
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                document.getElementById('loading-data').innerHTML = 'Erro ao carregar dados: ' + error.message;
            }
        }

        function analyzeBasicStats() {
            const total = parlamentares.length;
            const sample = parlamentares[0] || {};
            attributes = Object.keys(sample);
            
            document.getElementById('basic-stats').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Total de Registros</h4>
                        <div class="value">${total.toLocaleString('pt-BR')}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Atributos por Registro</h4>
                        <div class="value">${attributes.length}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Fontes de Dados</h4>
                        <div class="value">3</div>
                    </div>
                    <div class="stat-card">
                        <h4>Per√≠odo de Coleta</h4>
                        <div class="value">Dez/2024</div>
                    </div>
                </div>
            `;
        }

        function analyzeAttributes() {
            let html = `
                <h4>üìã Atributos Encontrados (${attributes.length} campos):</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Atributo</th>
                            <th>Descri√ß√£o Estimada</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            const descriptions = {
                'nome': 'Nome parlamentar ou completo',
                'nome_civil': 'Nome civil registrado',
                'partido': 'Sigla do partido pol√≠tico',
                'uf': 'Unidade Federativa (estado)',
                'cargo': 'Cargo pol√≠tico ocupado',
                'municipio': 'Munic√≠pio de atua√ß√£o',
                'periodo_mandato': 'Per√≠odo do mandato atual',
                'data_nascimento': 'Data de nascimento',
                'naturalidade': 'Local de nascimento',
                'telefones': 'Contatos telef√¥nicos',
                'email': 'Endere√ßo de email institucional',
                'link_perfil': 'URL do perfil oficial',
                'fonte_dados': 'Origem dos dados',
                'data_extracao': 'Data da coleta'
            };
            
            attributes.forEach((attr, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${attr}</strong></td>
                        <td>${descriptions[attr] || 'Campo espec√≠fico da fonte'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            document.getElementById('attributes-analysis').innerHTML = html;
        }

        function detectDataType(values) {
            const nonEmpty = values.filter(v => v && String(v).trim() && v !== 'N/A');
            
            if (nonEmpty.length === 0) return 'Vazio';
            
            // Teste para data
            const datePattern = /^\d{2}\/\d{2}\/\d{4}$/;
            if (nonEmpty.slice(0, 10).every(v => datePattern.test(String(v)))) {
                return 'Data';
            }
            
            // Teste para n√∫mero
            if (nonEmpty.slice(0, 10).every(v => !isNaN(Number(String(v).replace(',', '.'))))) {
                return 'N√∫mero';
            }
            
            // Teste para email
            if (nonEmpty.slice(0, 10).some(v => String(v).includes('@'))) {
                return 'Email';
            }
            
            return 'Texto';
        }

        function analyzeDataTypes() {
            dataTypes = {};
            const typeCount = {};
            
            attributes.forEach(attr => {
                const values = parlamentares.map(record => record[attr]);
                const type = detectDataType(values);
                dataTypes[attr] = type;
                typeCount[type] = (typeCount[type] || 0) + 1;
            });
            
            let html = `
                <h4>üîç Distribui√ß√£o de Tipos de Dados:</h4>
                <div class="chart-container">
            `;
            
            Object.entries(typeCount).forEach(([type, count]) => {
                const percentage = (count / attributes.length * 100).toFixed(1);
                html += `
                    <div class="chart-bar">
                        <div class="chart-label">${type}</div>
                        <div class="chart-bar-fill" style="width: ${percentage}%"></div>
                        <div class="chart-value">${count} campos (${percentage}%)</div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            html += `
                <h4>üìù Detalhamento por Campo:</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Campo</th>
                            <th>Tipo Detectado</th>
                            <th>Indicador</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            attributes.forEach(attr => {
                const type = dataTypes[attr];
                let indicator = 'quality-high';
                if (type === 'Vazio') indicator = 'quality-low';
                else if (type === 'Texto') indicator = 'quality-medium';
                
                html += `
                    <tr>
                        <td>${attr}</td>
                        <td>${type}</td>
                        <td><span class="quality-indicator ${indicator}">${type}</span></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            document.getElementById('data-types-analysis').innerHTML = html;
        }

        function analyzeCompleteness() {
            completeness = {};
            const total = parlamentares.length;
            
            // Campos cr√≠ticos a serem desconsiderados do c√°lculo de score
            const camposCriticos = ['comissoes', 'formacao', 'link_perfil', 'telefones'];
            
            attributes.forEach(attr => {
                const nonEmptyCount = parlamentares.filter(record => 
                    record[attr] && String(record[attr]).trim() && record[attr] !== 'N/A'
                ).length;
                completeness[attr] = (nonEmptyCount / total) * 100;
            });
            
            const sortedCompleteness = Object.entries(completeness).sort((a, b) => b[1] - a[1]);
            
            let html = `
                <h4>üìä Ranking de Completude dos Campos:</h4>
                <div class="chart-container">
            `;
            
            sortedCompleteness.forEach(([attr, percentage]) => {
                let quality = 'quality-high';
                if (percentage < 50) quality = 'quality-low';
                else if (percentage < 80) quality = 'quality-medium';
                
                html += `
                    <div class="chart-bar">
                        <div class="chart-label">${attr}</div>
                        <div class="chart-bar-fill" style="width: ${percentage}%"></div>
                        <div class="chart-value">
                            <span class="quality-indicator ${quality}">${percentage.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            const highCompleteness = sortedCompleteness.filter(([, p]) => p >= 90).length;
            const mediumCompleteness = sortedCompleteness.filter(([, p]) => p >= 50 && p < 90).length;
            const lowCompleteness = sortedCompleteness.filter(([, p]) => p < 50).length;
            
            html += `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Campos Completos (‚â•90%)</h4>
                        <div class="value">${highCompleteness}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Campos Parciais (50-89%)</h4>
                        <div class="value">${mediumCompleteness}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Campos Incompletos (<50%)</h4>
                        <div class="value">${lowCompleteness}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Completude M√©dia Geral</h4>
                        <div class="value">${(() => {
                            const completudeRelevante = Object.entries(completeness).filter(([attr, _]) => !camposCriticos.includes(attr));
                            const somaCompletude = completudeRelevante.reduce((sum, [_, percentage]) => sum + percentage, 0);
                            return (somaCompletude / completudeRelevante.length).toFixed(1);
                        })()}%</div>
                    </div>
                </div>
            `;
            
            document.getElementById('completeness-analysis').innerHTML = html;
        }

        function analyzeTextSizes() {
            const textFields = attributes.filter(attr => 
                dataTypes[attr] === 'Texto' || dataTypes[attr] === 'Email'
            );
            
            let html = `<h4>üìè Estat√≠sticas de Tamanho para Campos de Texto:</h4>`;
            
            if (textFields.length === 0) {
                html += '<p>Nenhum campo de texto identificado para an√°lise.</p>';
            } else {
                html += `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Campo</th>
                                <th>Tamanho M√≠n.</th>
                                <th>Tamanho M√°x.</th>
                                <th>Tamanho M√©dio</th>
                                <th>Amostras</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                textFields.forEach(attr => {
                    const lengths = [];
                    parlamentares.forEach(record => {
                        const value = record[attr];
                        if (value && String(value).trim() && value !== 'N/A') {
                            lengths.push(String(value).length);
                        }
                    });
                    
                    if (lengths.length > 0) {
                        const min = Math.min(...lengths);
                        const max = Math.max(...lengths);
                        const avg = (lengths.reduce((a, b) => a + b, 0) / lengths.length).toFixed(1);
                        
                        html += `
                            <tr>
                                <td>${attr}</td>
                                <td>${min}</td>
                                <td>${max}</td>
                                <td>${avg}</td>
                                <td>${lengths.length}</td>
                            </tr>
                        `;
                    }
                });
                
                html += '</tbody></table>';
            }
            
            document.getElementById('text-size-analysis').innerHTML = html;
        }

        function analyzeQuality() {
            const issues = {
                'empty_names': 0,
                'missing_party': 0,
                'missing_state': 0,
                'duplicate_names': 0
            };
            
            const namesSeen = new Set();
            
            parlamentares.forEach(record => {
                // Nomes vazios
                if (!record.nome || !String(record.nome).trim()) {
                    issues.empty_names++;
                }
                
                // Partidos vazios
                if (!record.partido || record.partido === 'N/A') {
                    issues.missing_party++;
                }
                
                // Estados vazios
                if (!record.uf || String(record.uf).length !== 2) {
                    issues.missing_state++;
                }
                
                // Nomes duplicados
                const nome = String(record.nome || '').trim().toLowerCase();
                if (nome && namesSeen.has(nome)) {
                    issues.duplicate_names++;
                } else if (nome) {
                    namesSeen.add(nome);
                }
            });
            
            const total = parlamentares.length;
            
            let html = `
                <h4>üîç Indicadores de Qualidade dos Dados:</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Nomes V√°lidos</h4>
                        <div class="value">${((total - issues.empty_names) / total * 100).toFixed(1)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Partidos Informados</h4>
                        <div class="value">${((total - issues.missing_party) / total * 100).toFixed(1)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Estados V√°lidos</h4>
                        <div class="value">${((total - issues.missing_state) / total * 100).toFixed(1)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Duplicatas Detectadas</h4>
                        <div class="value">${issues.duplicate_names}</div>
                    </div>
                </div>
                
                <h4>üìã Resumo de Problemas Detectados:</h4>
                <div class="chart-container">
            `;
            
            const problemTypes = [
                { name: 'Nomes Vazios', count: issues.empty_names },
                { name: 'Partidos Ausentes', count: issues.missing_party },
                { name: 'Estados Inv√°lidos', count: issues.missing_state },
                { name: 'Nomes Duplicados', count: issues.duplicate_names }
            ];
            
            const maxIssues = Math.max(...problemTypes.map(p => p.count)) || 1;
            
            problemTypes.forEach(problem => {
                const percentage = (problem.count / maxIssues * 100).toFixed(1);
                let quality = 'quality-high';
                if (problem.count > total * 0.1) quality = 'quality-low';
                else if (problem.count > total * 0.05) quality = 'quality-medium';
                
                html += `
                    <div class="chart-bar">
                        <div class="chart-label">${problem.name}</div>
                        <div class="chart-bar-fill" style="width: ${percentage}%"></div>
                        <div class="chart-value">
                            <span class="quality-indicator ${quality}">${problem.count}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('quality-analysis').innerHTML = html;
        }

        function generateExecutiveSummary() {
            const total = parlamentares.length;
            
            // Campos cr√≠ticos desconsiderados do c√°lculo final
            const camposCriticos = ['comissoes', 'formacao', 'link_perfil', 'telefones'];
            const completudeRelevante = Object.entries(completeness).filter(([attr, _]) => !camposCriticos.includes(attr));
            const avgCompleteness = (completudeRelevante.reduce((sum, [_, percentage]) => sum + percentage, 0) / completudeRelevante.length).toFixed(1);
            const highQualityFields = completudeRelevante.filter(([_, p]) => p >= 90).length;
            
            let qualityLevel = 'ALTA';
            if (avgCompleteness < 70) qualityLevel = 'BAIXA';
            else if (avgCompleteness < 85) qualityLevel = 'M√âDIA';
            
            const html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Qualidade Geral</h4>
                        <div class="value">${qualityLevel}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Completude M√©dia</h4>
                        <div class="value">${avgCompleteness}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Campos de Alta Qualidade</h4>
                        <div class="value">${highQualityFields}/${completudeRelevante.length}</div>
                    </div>
                    <div class="stat-card">
                        <h4>Registros Analisados</h4>
                        <div class="value">${total.toLocaleString('pt-BR')}</div>
                    </div>
                </div>
                
                <h3>üéØ Principais Conclus√µes:</h3>
                <ul>
                    <li><strong>Estrutura dos Dados:</strong> ${attributes.length} atributos identificados, cobrindo informa√ß√µes pessoais, pol√≠ticas e de contato.</li>
                    <li><strong>Completude:</strong> Completude m√©dia de ${avgCompleteness}%, indicando qualidade ${qualityLevel.toLowerCase()} dos dados (campos cr√≠ticos exclu√≠dos do c√°lculo).</li>
                    <li><strong>Tipos de Dados:</strong> Predomin√¢ncia de campos de texto, com boa identifica√ß√£o de datas e emails.</li>
                    <li><strong>Consist√™ncia:</strong> Baixo √≠ndice de duplicatas e inconsist√™ncias estruturais.</li>
                    <li><strong>Metodologia:</strong> Campos com baixa completude (comiss√µes, forma√ß√£o, link_perfil, telefones) foram exclu√≠dos do score geral para refletir melhor a qualidade dos dados essenciais.</li>
                </ul>
                
                <h3>üí° Recomenda√ß√µes:</h3>
                <ul>
                    <li><strong>Prioridade Alta:</strong> Melhorar completude dos campos com menos de 50% de preenchimento.</li>
                    <li><strong>Prioridade M√©dia:</strong> Implementar valida√ß√£o de formatos para datas e emails.</li>
                    <li><strong>Prioridade Baixa:</strong> Padronizar nomenclaturas de partidos e naturalidades.</li>
                    <li><strong>Monitoramento:</strong> Estabelecer processo cont√≠nuo de valida√ß√£o de qualidade.</li>
                </ul>
            `;
            
            document.getElementById('executive-summary').innerHTML = html;
        }

        // Carregar dados quando a p√°gina carregar
        window.onload = loadAndAnalyzeData;
    </script>
</body>
</html>